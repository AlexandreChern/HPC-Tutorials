---
layout: tutorial_page
title: "Exercise 1"
release_number: UCRL-MI-133316
author: Blaise Barney, Lawrence Livermore National Laboratory
---

### Overview:
* Login to an LC cluster using your workshop username and OTP token
* Copy the exercise files to your home directory
* Familiarize yourself with LC's Pthreads environment
* Write a simple "Hello World" Pthreads program
* Successfully compile your program
* Successfully run your program - several different ways
* Review, compile, run and/or debug some related Pthreads programs (provided)

### 1. Login to the workshop machine
Workshops differ in how this is done. The instructor will go over this beforehand.

### 2. Copy the example files
In your home directory, create a pthreads subdirectory for the example codes, copy the example codes and then `cd` into your pthreads subdirectory:
```
mkdir pthreads 
cp  /usr/global/docs/training/blaise/pthreads/*   ~/pthreads
cd  pthreads
```
### 3. List the contents of your pthreads subdirectory
You should notice a number of files as shown in the tables below.

<table style="border-collapse:collapse;border-spacing:0" class="tg"><thead><tr><th style="background-color:#98ABCE;border-color:inherit;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;font-weight:bold;overflow:hidden;padding:10px 5px;position:-webkit-sticky;position:sticky;text-align:center;top:-1px;vertical-align:top;will-change:transform;word-break:normal"><span style="background-color:#98ABCE">File Name</span></th><th style="background-color:#98ABCE;border-color:inherit;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;font-weight:bold;overflow:hidden;padding:10px 5px;position:-webkit-sticky;position:sticky;text-align:center;top:-1px;vertical-align:top;will-change:transform;word-break:normal" colspan="2"><span style="background-color:#98ABCE">Description</span></th></tr></thead><tbody><tr><td style="border-color:inherit;border-style:solid;border-width:1px;color:#339;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">[arrayloops.c](samples/arrayloops.c)<br>[arrayloops.f](samples/arrayloops.f)</td><td style="border-color:inherit;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal" colspan="2">Data decomposition by loop distribution. Fortran example only works under IBM AIX: see comments in source code for compilation instructions.</td></tr><tr><td style="border-color:inherit;border-style:solid;border-width:1px;color:#339;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">[condvar.c](samples/condvar.c)</td><td style="border-color:inherit;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal" colspan="2">Condition variable example file. Similar to what was shown in the tutorial</td></tr><tr><td style="border-color:inherit;border-style:solid;border-width:1px;color:#339;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">[detached.c](samples/detached.c)</td><td style="border-color:inherit;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal" colspan="2">Demonstrates how to explicitly create pthreads in a detached state.</td></tr><tr><td style="border-color:inherit;border-style:solid;border-width:1px;color:#339;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">[dotprod_mutex.c](samples/dotprod_mutex.c)<br>[dotprod_serial.c](samples/dotprod_serial.c)</td><td style="border-color:inherit;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal" colspan="2">Mutex variable example using a dot product program. Both a serial and pthreads version of the code are available.</td></tr><tr><td style="border-color:inherit;border-style:solid;border-width:1px;color:#339;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">[hello.c](samples/hello.c)</td><td style="border-color:inherit;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal" colspan="2">Simple "Hello World" example</td></tr><tr><td style="border-color:inherit;border-style:solid;border-width:1px;color:#339;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">[hello32.c](samples/hello32.c)</td><td style="border-color:inherit;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal" colspan="2">"Hello World" pthreads program demonstrating thread scheduling behavior.</td></tr><tr><td style="border-color:inherit;border-style:solid;border-width:1px;color:#339;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">[hello_arg1.c](samples/hello_arg1.c)</td><td style="border-color:inherit;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal" colspan="2">One correct way of passing the pthread_create() argument.</td></tr><tr><td style="border-color:inherit;border-style:solid;border-width:1px;color:#339;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">[hello_arg2.c](samples/hello_arg2.c)</td><td style="border-color:inherit;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal" colspan="2">Another correct method of passing the pthread_create() argument, this time using a structure to pass multiple arguments.</td></tr><tr><td style="border-color:inherit;border-style:solid;border-width:1px;color:#339;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">[join.c](samples/join.c)</td><td style="border-color:inherit;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal" colspan="2">Demonstrates how to explicitly create pthreads in a joinable state for portability purposes. Also shows how to use the pthread_exit status parameter.</td></tr><tr><td style="border-color:inherit;border-style:solid;border-width:1px;color:#339;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">[mpithreads_serial.c](samples/mpithreads_serial.c)<br>[mpithreads_threads.c](samples/mpithreads_threads.c)<br>[mpithreads_mpi.c](samples/mpithreads_mpi.c)<br>[mpithreads_both.c](samples/mpithreads_both.c)<br>[mpithreads.makefile](samples/mpithreads.makefile)</td><td style="border-color:inherit;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal" colspan="2">A "series" of programs which demonstrate the progression for a serial dot product code to a hybrid MPI/Pthreads implementation. Files include the serial version, Pthreads version, MPI version, hybrid version and a makefile.</td></tr></tbody></table>

<table style="border-collapse:collapse;border-spacing:0" class="tg"><thead><tr><th style="background-color:#98ABCE;border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;font-weight:bold;overflow:hidden;padding:10px 5px;position:-webkit-sticky;position:sticky;text-align:center;top:-1px;vertical-align:top;will-change:transform;word-break:normal"><span style="background-color:#98ABCE">Bug Code</span></th><th style="background-color:#98ABCE;border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;font-weight:bold;overflow:hidden;padding:10px 5px;position:-webkit-sticky;position:sticky;text-align:center;top:-1px;vertical-align:top;will-change:transform;word-break:normal"><span style="background-color:#98ABCE">Bug Behavior</span></th></tr></thead><tbody><tr><td style="border-color:black;border-style:solid;border-width:1px;color:#339;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal"><span style="font-weight:normal;font-style:normal;color:#000">[bug1.c](samples/bug1.c)</span><br><span style="font-weight:normal;font-style:normal;color:#000">[bug1fix.c](samples/bug1fix.c)</span></td><td style="border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">Hangs</td></tr><tr><td style="border-color:black;border-style:solid;border-width:1px;color:#339;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal"><span style="font-weight:normal;font-style:normal;color:#000">[bug2.c](samples/bug2.c)</span><br><span style="font-weight:normal;font-style:normal;color:#000">[bug2fix.c](samples/bug2fix.c)</span></td><td style="border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">Seg fault/coredump</td></tr><tr><td style="border-color:black;border-style:solid;border-width:1px;color:#339;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal"><span style="font-weight:normal;font-style:normal;color:#000">[bug3.c](samples/bug3.c)</span></td><td style="border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">Wrong answers</td></tr><tr><td style="border-color:black;border-style:solid;border-width:1px;color:#339;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal"><span style="font-weight:normal;font-style:normal;color:#000">[bug4.c](samples/bug4.c)</span><br><span style="font-weight:normal;font-style:normal;color:#000">[bug4fix.c](samples/bug4fix.c)</span></td><td style="border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">Hangs (usually)</td></tr><tr><td style="border-color:black;border-style:solid;border-width:1px;color:#339;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal"><span style="font-weight:normal;font-style:normal;color:#000">[bug5.c](samples/bug5.c)</span></td><td style="border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">Threads die and never get to do their work</td></tr><tr><td style="border-color:black;border-style:solid;border-width:1px;color:#339;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal"><span style="font-weight:normal;font-style:normal;color:#000">[bug6.c](samples/bug6.c)</span><br><span style="font-weight:normal;font-style:normal;color:#000">[bug6fix.c](samples/bug6fix.c)</span></td><td style="border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">Wrong answer - run it several times to prove this</td></tr></tbody></table>

<details>
    <summary> Click here for more hints about the bugs in the above table. </summary>
 
 <table style="border-collapse:collapse;border-spacing:0" class="tg"><thead><tr><th style="background-color:#98ABCE;border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;font-weight:bold;overflow:hidden;padding:10px 5px;position:-webkit-sticky;position:sticky;text-align:center;top:-1px;vertical-align:top;will-change:transform;word-break:normal"><span style="background-color:#98ABCE">Bug Code</span></th><th style="background-color:#98ABCE;border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;font-weight:bold;overflow:hidden;padding:10px 5px;position:-webkit-sticky;position:sticky;text-align:center;top:-1px;vertical-align:top;will-change:transform;word-break:normal"><span style="background-color:#98ABCE">Bug Behavior</span></th><th style="background-color:#98ABCE;border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;font-weight:bold;overflow:hidden;padding:10px 5px;position:-webkit-sticky;position:sticky;text-align:center;top:-1px;vertical-align:top;will-change:transform;word-break:normal"><span style="background-color:#98ABCE">Hints/Notes</span></th></tr></thead><tbody><tr><td style="border-color:black;border-style:solid;border-width:1px;color:#339;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal"><span style="font-weight:normal;font-style:normal;color:#000">[bug1.c](samples/bug1.c)</span><br><span style="font-weight:normal;font-style:normal;color:#000">[bug1fix.c](samples/bug1fix.c)</span></td><td style="border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">Hangs</td><td style="border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">The header comments in bug1.c explain the problem. More than one thread is waiting for a condition signal, but only one is sent. The solution overcomes this by using a condition signal broadcast.</td></tr><tr><td style="border-color:black;border-style:solid;border-width:1px;color:#339;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal"><span style="font-weight:normal;font-style:normal;color:#000">[bug2.c](samples/bug2.c)</span><br><span style="font-weight:normal;font-style:normal;color:#000">[bug2fix.c](samples/bug2fix.c)</span></td><td style="border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">Seg fault/coredump</td><td style="border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">The bug2.c program seg faults because it has exhausted the default thread stack space. The bug2fix.c program shows how to overcome this by explicitly setting an adequate thread stack size.</td></tr><tr><td style="border-color:black;border-style:solid;border-width:1px;color:#339;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal"><span style="font-weight:normal;font-style:normal;color:#000">[bug3.c](samples/bug3.c)</span></td><td style="border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">Wrong answers</td><td style="border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">bug3.c shows an unsafe way to pass the argument parameter in the pthread_create routine. It passes the address of t, rather than the value. As a result, each thread looks at the same location for their supposed unique instance of t. By the times the threads start, the thread creation loop is done and t is equal to 8 - usually. This means each thread gets an invalid and non-unique value for t. Compare with hello_arg1.c for one coorect way of passing t.</td></tr><tr><td style="border-color:black;border-style:solid;border-width:1px;color:#339;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal"><span style="font-weight:normal;font-style:normal;color:#000">[bug4.c](samples/bug4.c)</span><br><span style="font-weight:normal;font-style:normal;color:#000">[bug4fix.c](samples/bug4fix.c)</span></td><td style="border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">Hangs (usually)</td><td style="border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">bug4.c demonstrates a synchronization problem because the condition signal gets sent before the condition wait is posted. Plus, the waiting thread does not check to see if the condition it needs is true or not. So it blindly calls the condition wait and will hang forever. The solution bug4fix.c shows one way of overcoming this problem.</td></tr><tr><td style="border-color:black;border-style:solid;border-width:1px;color:#339;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal"><span style="font-weight:normal;font-style:normal;color:#000">[bug5.c](samples/bug5.c)</span></td><td style="border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">Threads die and never get to do their work</td><td style="border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">bug5.c is simply missing a pthread_exit call at the end of main. As a result, when main finishes, it goes away as do all of its threads. Adding a pthread_exit routine at the end of main will solve the problem.</td></tr><tr><td style="border-color:black;border-style:solid;border-width:1px;color:#339;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal"><span style="font-weight:normal;font-style:normal;color:#000">[bug6.c](samples/bug6.c)</span><br><span style="font-weight:normal;font-style:normal;color:#000">[bug6fix.c](samples/bug6fix.c)</span></td><td style="border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">Wrong answer - run it several times to prove this</td><td style="border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">bug6.c shows how shared memory can be misused by multiple threads. All are attempting to update the global sum at the same time without any synchronization mechanism. As a result, the answer will almost always vary and be wrong. Using a mutex variable around the update of the global sum variable will solve this problem. The solution bug6fix.c shows one way to do this, but dotprod_mutex.c shows a more efficient way to accomplish this.</td></tr></tbody></table><table style="border-collapse:collapse;border-spacing:0" class="tg"><thead><tr><th style="background-color:#98ABCE;border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;font-weight:bold;overflow:hidden;padding:10px 5px;position:-webkit-sticky;position:sticky;text-align:center;top:-1px;vertical-align:top;will-change:transform;word-break:normal"><span style="background-color:#98ABCE">Bug Code</span></th><th style="background-color:#98ABCE;border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;font-weight:bold;overflow:hidden;padding:10px 5px;position:-webkit-sticky;position:sticky;text-align:center;top:-1px;vertical-align:top;will-change:transform;word-break:normal"><span style="background-color:#98ABCE">Bug Behavior</span></th><th style="background-color:#98ABCE;border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;font-weight:bold;overflow:hidden;padding:10px 5px;position:-webkit-sticky;position:sticky;text-align:center;top:-1px;vertical-align:top;will-change:transform;word-break:normal"><span style="background-color:#98ABCE">Hints/Notes</span></th></tr></thead><tbody><tr><td style="border-color:black;border-style:solid;border-width:1px;color:#339;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal"><span style="font-weight:normal;font-style:normal;color:#000">[bug1.c](samples/bug1.c)</span><br><span style="font-weight:normal;font-style:normal;color:#000">[bug1fix.c](samples/bug1fix.c)</span></td><td style="border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">Hangs</td><td style="border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">The header comments in bug1.c explain the problem. More than one thread is waiting for a condition signal, but only one is sent. The solution overcomes this by using a condition signal broadcast.</td></tr><tr><td style="border-color:black;border-style:solid;border-width:1px;color:#339;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal"><span style="font-weight:normal;font-style:normal;color:#000">[bug2.c](samples/bug2.c)</span><br><span style="font-weight:normal;font-style:normal;color:#000">[bug2fix.c](samples/bug2fix.c)</span></td><td style="border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">Seg fault/coredump</td><td style="border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">The bug2.c program seg faults because it has exhausted the default thread stack space. The bug2fix.c program shows how to overcome this by explicitly setting an adequate thread stack size.</td></tr><tr><td style="border-color:black;border-style:solid;border-width:1px;color:#339;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal"><span style="font-weight:normal;font-style:normal;color:#000">[bug3.c](samples/bug3.c)</span></td><td style="border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">Wrong answers</td><td style="border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">bug3.c shows an unsafe way to pass the argument parameter in the pthread_create routine. It passes the address of t, rather than the value. As a result, each thread looks at the same location for their supposed unique instance of t. By the times the threads start, the thread creation loop is done and t is equal to 8 - usually. This means each thread gets an invalid and non-unique value for t. Compare with hello_arg1.c for one coorect way of passing t.</td></tr><tr><td style="border-color:black;border-style:solid;border-width:1px;color:#339;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal"><span style="font-weight:normal;font-style:normal;color:#000">[bug4.c](samples/bug4.c)</span><br><span style="font-weight:normal;font-style:normal;color:#000">[bug4fix.c](samples/bug4fix.c)</span></td><td style="border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">Hangs (usually)</td><td style="border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">bug4.c demonstrates a synchronization problem because the condition signal gets sent before the condition wait is posted. Plus, the waiting thread does not check to see if the condition it needs is true or not. So it blindly calls the condition wait and will hang forever. The solution bug4fix.c shows one way of overcoming this problem.</td></tr><tr><td style="border-color:black;border-style:solid;border-width:1px;color:#339;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal"><span style="font-weight:normal;font-style:normal;color:#000">[bug5.c](samples/bug5.c)</span></td><td style="border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">Threads die and never get to do their work</td><td style="border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">bug5.c is simply missing a pthread_exit call at the end of main. As a result, when main finishes, it goes away as do all of its threads. Adding a pthread_exit routine at the end of main will solve the problem.</td></tr><tr><td style="border-color:black;border-style:solid;border-width:1px;color:#339;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal"><span style="font-weight:normal;font-style:normal;color:#000">[bug6.c](samples/bug6.c)</span><br><span style="font-weight:normal;font-style:normal;color:#000">[bug6fix.c](samples/bug6fix.c)</span></td><td style="border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">Wrong answer - run it several times to prove this</td><td style="border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;text-align:left;vertical-align:top;word-break:normal">bug6.c shows how shared memory can be misused by multiple threads. All are attempting to update the global sum at the same time without any synchronization mechanism. As a result, the answer will almost always vary and be wrong. Using a mutex variable around the update of the global sum variable will solve this problem. The solution bug6fix.c shows one way to do this, but dotprod_mutex.c shows a more efficient way to accomplish this.</td></tr></tbody></table>
 
</details>

### 4. Compilers - What's Available?
* Visit the [Compilers Currently Installed](https://computing.llnl.gov/?set=code&page=compilers) on LC Platforms webpage.

* Click on the name of the workshop Linux cluster (sierra) in the summary table near the top of the page. This will take you to a table of available compilers.

* You can also view the available compilers in the [Compilers](https://computing.llnl.gov/tutorials/linux_clusters/index.html#Compilers) section of the Linux Clusters Overview tutorial.

* Now, in your cluster login window, try the `use -l compilers` command to display available compilers. You should see GNU, Intel and PGI compilers - several versions of each.
  * Question: Which version is the default version?
  * Answer: Use the `dpkg-defaults` command and look for the asterisk.

### 5. Create, compile and run a Pthreads "Hello world" program
* Using your favorite text editor (vi/vim, emacs, nedit, gedit, nano...) open a new file - call it whatever you'd like.

* Create a simple Pthreads program that does the following:
   * Includes the `pthread.h` header file
   * Main program creates several threads, each of which executes a "print hello" thread routine. The argument passed to that routine is their thread ID.
   * The thread's "print hello" routine accepts the thread ID argument and prints "hello world from thread #". Then it calls `pthread_exit` to finish.
   * Main program calls `pthread_exit` as the last thing it does
If you need help, see the provided [hello.c](samples/hello.c)  file.

* Using your choice of compiler (see above section 4), compile your hello world Pthreads program. This may take several attempts if there are any code errors. For example:
```
icc -pthread -o hello myhello.c
pgcc -lpthread -o hello myhello.c
gcc -pthread -o hello myhello.c
```
When you get a clean compile, proceed.

* Run your `hello` executable and notice its output. Is it what you expected? As a comparison, you can compile and run the provided [hello.c](samples/hello.c) example program.
* **Notes**:
   * For the remainder of this exercise, you can use the compiler command of your choice unless indicated otherwise.
   * Compilers will differ in which warnings they issue, but all can be ignored for this exercise. Errors are different, of course.

### 6. Thread Scheduling
* Review the example code `hello32.c`. Note that it will create 32 threads. A `sleep();` statement has been introduced to help insure that all threads will be in existence at the same time. Also, each thread performs actual work to demonstrate how the OS scheduler behavior determines the order of thread completion.

* Compile and run the program. Notice the order in which thread output is displayed. Is it ever in the same order? How is this explained?

### 7. Argument Passing

* Review the `hello_arg1.c` and `hello_arg2.c` example codes. Notice how the single argument is passed and how to pass multiple arguments through a structure.

* Compile and run both programs, and observe output.

* Now review, compile and run the `bug3.c` program. What's wrong? How would you fix it? See the explanation in the bug programs table above.

### 8. Thread Exiting

* Review, compile (for gcc include the `-lm` flag) and run the `bug5.c` program.

* What happens? Why? How would you fix it?

* See the explanation in the bug programs table above.

### 9. Thread Joining

* Review, compile (for gcc include the `-lm` flag) and run the `join.c` program.

* Modify the program so that threads send back a different return code - you pick. Compile and run. Did it work?

* For comparison, review, compile (for gcc include the -lm flag) and run the `detached.c` example code.

* Observe the behavior and note there is no "join" in this example.

### 10. Stack Management

* Review, compile and run the bug2.c program.

* What happens? Why? How would you fix it?

* See the explanation in the bug programs table above. Also review and try out `bug2fix.c` program.
